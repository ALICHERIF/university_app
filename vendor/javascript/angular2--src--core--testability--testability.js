import t from"angular2/src/facade/lang";import e from"angular2/src/core/di";import i from"angular2/src/facade/exceptions";import n from"angular2/src/facade/collection";import"../../facade/base_wrapped_exception.js";import"angular2/src/facade/base_wrapped_exception";import"../../facade/exception_handler.js";import"../../facade/exceptions.js";import a from"angular2/src/facade/async";import"../zone/ng_zone_impl.js";import s from"../zone/ng_zone.js";"use strict";var r={};var o=r&&r.__decorate||function(t,e,i,n){var a=arguments.length,s=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n,r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var o=t.length-1;o>=0;o--)(r=t[o])&&(s=(a<3?r(s):a>3?r(e,i,s):r(e,i))||s);return a>3&&s&&Object.defineProperty(e,i,s),s};var l=r&&r.__metadata||function(t,e){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(t,e)};var p=e;var c=n;var u=t;var y=i;var b=s;var f=a;var d=function(){function Testability(t){this._ngZone=t;this._pendingCount=0;this._isZoneStable=true;this._didWork=false;this._callbacks=[];this._watchAngularEvents()}Testability.prototype._watchAngularEvents=function(){var t=this;f.ObservableWrapper.subscribe(this._ngZone.onUnstable,(function(e){t._didWork=true;t._isZoneStable=false}));this._ngZone.runOutsideAngular((function(){f.ObservableWrapper.subscribe(t._ngZone.onStable,(function(e){b.NgZone.assertNotInAngularZone();u.scheduleMicroTask((function(){t._isZoneStable=true;t._runCallbacksIfReady()}))}))}))};Testability.prototype.increasePendingRequestCount=function(){this._pendingCount+=1;this._didWork=true;return this._pendingCount};Testability.prototype.decreasePendingRequestCount=function(){this._pendingCount-=1;if(this._pendingCount<0)throw new y.BaseException("pending async requests below zero");this._runCallbacksIfReady();return this._pendingCount};Testability.prototype.isStable=function(){return this._isZoneStable&&0==this._pendingCount&&!this._ngZone.hasPendingMacrotasks};Testability.prototype._runCallbacksIfReady=function(){var t=this;this.isStable()?u.scheduleMicroTask((function(){while(0!==t._callbacks.length)t._callbacks.pop()(t._didWork);t._didWork=false})):this._didWork=true};Testability.prototype.whenStable=function(t){this._callbacks.push(t);this._runCallbacksIfReady()};Testability.prototype.getPendingRequestCount=function(){return this._pendingCount};Testability.prototype.findBindings=function(t,e,i){return[]};Testability.prototype.findProviders=function(t,e,i){return[]};Testability=o([p.Injectable(),l("design:paramtypes",[b.NgZone])],Testability);return Testability}();r.Testability=d;var g=function(){function TestabilityRegistry(){this._applications=new c.Map;T.addToWindow(this)}TestabilityRegistry.prototype.registerApplication=function(t,e){this._applications.set(t,e)};TestabilityRegistry.prototype.getTestability=function(t){return this._applications.get(t)};TestabilityRegistry.prototype.getAllTestabilities=function(){return c.MapWrapper.values(this._applications)};TestabilityRegistry.prototype.getAllRootElements=function(){return c.MapWrapper.keys(this._applications)};TestabilityRegistry.prototype.findTestabilityInTree=function(t,e){void 0===e&&(e=true);return T.findTestabilityInTree(this,t,e)};TestabilityRegistry=o([p.Injectable(),l("design:paramtypes",[])],TestabilityRegistry);return TestabilityRegistry}();r.TestabilityRegistry=g;var _=function(){function _NoopGetTestability(){}_NoopGetTestability.prototype.addToWindow=function(t){};_NoopGetTestability.prototype.findTestabilityInTree=function(t,e,i){return null};_NoopGetTestability=o([u.CONST(),l("design:paramtypes",[])],_NoopGetTestability);return _NoopGetTestability}();function setTestabilityGetter(t){T=t}r.setTestabilityGetter=setTestabilityGetter;var T=u.CONST_EXPR(new _);const h=r.Testability,R=r.TestabilityRegistry,m=r.setTestabilityGetter;export default r;export{h as Testability,R as TestabilityRegistry,m as setTestabilityGetter};

